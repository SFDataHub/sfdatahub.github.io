<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>S&F Data Hub</title>
  <!-- Google Font: Quicksand -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0C1C2E; --nav:#0A1728; --tile:#1A2F4A; --tile-hov:#25456B; --edge:#2B4C73;
      --txt:#FFFFFF; --mut:#B0C4D9; --icon:#5C8BC6; --active:#1F3B5D; --menu:#152A42; --menu-hov:#1E3A5C;
      --gold:#D4AF37; --badge:#E53935;
    }

    body{ margin:0; font-family:'Quicksand',sans-serif; background:transparent; color:var(--txt); }

    .navbar{
      display:flex; align-items:center; justify-content:center; gap:24px;
      padding:10px; background:transparent;
    }

    .nav-icon{
      position:relative; width:80px; height:50px;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; border-radius:12px; transition:background .3s ease;
      color:var(--txt); text-decoration:none;
    }

    .nav-icon img, .nav-icon .label{
      position:absolute; transition:opacity .25s ease; pointer-events:none;
    }

    .nav-icon img{ width:40px; height:40px; opacity:1; display:block; }
    .nav-icon .label{ opacity:0; font-size:14px; font-weight:600; }

    /* Hover: Icon aus, Text an, Button-HG */
    .nav-icon:hover{ background:var(--tile-hov); }
    .nav-icon:hover img{ opacity:0; }
    .nav-icon:hover .label{ opacity:1; }

    /* Aktiver Button: HG bleibt, Icon sichtbar, Text aus */
    .nav-icon.active{ background:var(--tile-hov); }
    .nav-icon.active img{ opacity:1; }
    .nav-icon.active .label{ display:none; }

    /* Badges */
    .badge{
      position:absolute; top:2px; right:4px;
      min-width:18px; height:18px; padding:0 5px;
      background:var(--badge); color:#fff; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      font-size:11px; font-weight:700; line-height:1;
      border:1px solid rgba(0,0,0,.25);
    }
    .badge.hidden{ display:none; }

    /* ⭐ Favoriten: Gold-Glow, wenn es Favoriten gibt */
    .nav-icon.fav.has-favs{
      box-shadow: 0 0 0 2px var(--gold), 0 0 12px rgba(212,175,55,.45);
      background: var(--tile);
    }

    /* ▼ Dropdown für Guilds */
    .nav-icon.dropdown{ overflow:visible; }
    .nav-icon .menu{
      position:absolute; top:56px; left:50%; transform:translateX(-50%);
      background:var(--menu); border:1px solid var(--edge); border-radius:12px;
      min-width:200px; padding:8px; display:none; z-index:10;
      box-shadow:0 12px 24px rgba(0,0,0,0.35);
    }
    .nav-icon .menu::before{
      content:""; position:absolute; top:-8px; left:50%; transform:translateX(-50%);
      border-left:8px solid transparent; border-right:8px solid transparent; border-bottom:8px solid var(--menu);
    }
    .nav-icon .menu ul{ list-style:none; margin:0; padding:0; }
    .nav-icon .menu li{ margin:0; padding:0; }
    .nav-icon .menu a,
    .nav-icon .menu button{
      width:100%; background:transparent; border:0; text-align:left; display:block;
      padding:10px 12px; color:var(--txt); font-family:inherit; font-size:14px;
      border-radius:8px; cursor:pointer; text-decoration:none;
    }
    .nav-icon .menu a:hover, .nav-icon .menu button:hover{ background:var(--menu-hov); }

    /* Dropdown sichtbar bei Hover, Fokus oder .open (für Touch) */
    .nav-icon.dropdown:hover .menu,
    .nav-icon.dropdown:focus-within .menu,
    .nav-icon.dropdown.open .menu{ display:block; }

    /* Optional: Standard ohne Aktiv-HG */
    .nav-icon:not(.active){ background:transparent; }
  </style>
</head>
<body>

  <!-- NAVBAR wird per JS erzeugt (damit URLs zentral konfiguriert sind) -->
  <div class="navbar" id="navbar"></div>

  <script>
    /* =========================
       KONFIGURATION – deine echten IDs
    ==========================*/
    const REPORT_ID = "7d34cb59-5874-470c-ad64-58a5c7aa9e01";  // <-- fest aus deiner URL

    // Page-IDs: die beiden bekannten gesetzt, Rest zunächst null → Hash-Fallback
    const PAGE = {
      dashboard:     "ZcEXF",         // Dashboard (Home)
      players:       null,            // später ergänzen
      guilds:        null,            // Overview
      guilds_compare:null,
      dream_squad:   null,
      hydra_trends:  null,
      servers:       null,
      latest_scan:   null,
      old_scans:     "p_ssob7p70vd",  // Old Scans
      notifications: null,
      favorites:     null
    };

    // Helper: baue absolute Looker-URL
    const pageURL  = (pageId) => pageId ? `https://lookerstudio.google.com/reporting/${REPORT_ID}/page/${pageId}` : null;
    const pageHref = (pageId, hashFallback) => pageURL(pageId) || `#${hashFallback}`;

    /* =========================
       NAV-DEFINITION (Reihenfolge & Labels)
    ==========================*/
    const NAV_ITEMS = [
      { key:"dashboard", label:"Dashboard", img:"https://i.postimg.cc/gcwk3jMp/Chat-GPT-Image-7-Sept-2025-10-55-58.png" },
      { key:"players",   label:"Player",    img:"https://i.postimg.cc/s2D3xgBt/iconplayer1.png" },
      {
        key:"guilds", label:"Guilds", img:"https://i.postimg.cc/zGkJqgfC/iconguilds1.png", dropdown:true, submenu:[
          { key:"guilds",         label:"Overview"     },
          { key:"guilds_compare", label:"Compare"      },
          { key:"dream_squad",    label:"Dream Squad"  },
          { key:"hydra_trends",   label:"Hydra Trends" }
        ]
      },
      { key:"servers",      label:"Server",      img:"https://i.postimg.cc/3wSYvQmW/iconserver1.png" },
      { key:"latest_scan",  label:"Latest Scan", img:"https://i.postimg.cc/QxLJy5gm/iconlatestscan2.png" },
      { key:"old_scans",    label:"Old Scans",   img:"https://i.postimg.cc/VLnfHTQH/iconoldscans1.png" },
      { key:"notifications",label:"Notifications",img:"https://i.postimg.cc/XNTNLWhC/iconclock1.png", badgeId:"badge-noti" },
      { key:"favorites",    label:"Favorite",    img:"https://i.postimg.cc/RZmSrRvC/iconfavorit1.png", badgeId:"badge-fav", isFav:true }
    ];

    /* =========================
       Favoriten (localStorage)
    ==========================*/
    const FAV_KEY = 'sf_favorites';
    const loadFavs = () => { try { return JSON.parse(localStorage.getItem(FAV_KEY)) || []; } catch { return []; } };
    const saveFavs = (list) => localStorage.setItem(FAV_KEY, JSON.stringify(list));
    const formatCount = (n) => (n>99 ? "99+" : String(n));

    /* =========================
       Navbar rendern
    ==========================*/
    const navbarEl = document.getElementById('navbar');

    function renderNav(){
      navbarEl.innerHTML = ""; // reset

      NAV_ITEMS.forEach(item => {
        const href = pageHref(PAGE[item.key], item.key);

        if (item.dropdown) {
          // Dropdown-Icon als klickbare Kachel (führt standardmäßig zu Overview-Link)
          const wrapper = document.createElement('a');
          wrapper.href = href;
          wrapper.target = "_parent";
          wrapper.className = 'nav-icon dropdown';
          wrapper.id = `nav-${item.key}`;
          wrapper.setAttribute('data-goto', item.key);

          wrapper.innerHTML = `
            <img src="${item.img}" alt="${item.label}">
            <span class="label">${item.label}</span>
            <div class="menu" role="menu" aria-label="${item.label} submenu">
              <ul>
                ${item.submenu.map(s => {
                  const subHref = pageHref(PAGE[s.key], s.key);
                  return `<li><a href="${subHref}" target="_parent" data-goto="${s.key}">${s.label}</a></li>`;
                }).join("")}
              </ul>
            </div>
          `;

          // Für Touch: erster Tap öffnet Menü, zweiter folgt Link
          wrapper.addEventListener('click', (e) => {
            const isMenu = e.target.closest('.menu');
            if (!isMenu) wrapper.classList.toggle('open');
          });

          // Außerhalb-Klick schließt
          document.addEventListener('click', (e) => {
            if (!e.target.closest(`#nav-${item.key}`)) wrapper.classList.remove('open');
          });

          navbarEl.appendChild(wrapper);
        } else {
          // Normale Kacheln als Links
          const a = document.createElement('a');
          a.href = href;
          a.target = "_parent";
          a.className = 'nav-icon';
          a.id = `nav-${item.key}`;
          a.setAttribute('data-goto', item.key);
          a.innerHTML = `
            <img src="${item.img}" alt="${item.label}">
            <span class="label">${item.label}</span>
            ${item.badgeId ? `<span class="badge hidden" id="${item.badgeId}">0</span>` : ""}
          `;
          if (item.isFav) a.classList.add('fav');
          navbarEl.appendChild(a);
        }
      });
    }

    /* =========================
       Active erkennen (echte URL + Hash)
       Erkennt /page/<PAGE_ID> oder #<key>
    ==========================*/
    function setActiveFromURL(){
      const url = new URL(window.location.href);
      const path = url.pathname;
      const hash = (url.hash || "").replace(/^#/, "");

      let activeKey = null;

      // 1) /page/<PAGE_ID>
      const match = path.match(/\/page\/([A-Za-z0-9_-]+)/);
      if (match) {
        const pageId = match[1];
        activeKey = Object.keys(PAGE).find(k => PAGE[k] === pageId) || null;
      }

      // 2) Fallback: Hash
      if (!activeKey && hash) {
        if (PAGE[hash] !== undefined || NAV_ITEMS.some(n => n.key === hash)) {
          activeKey = hash;
        }
      }

      // setzen
      document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
      if (activeKey) {
        const el = document.getElementById(`nav-${activeKey}`);
        if (el) el.classList.add('active');
      } else {
        // Default: Dashboard aktiv
        const def = document.getElementById('nav-dashboard');
        def && def.classList.add('active');
      }
    }

    /* =========================
       Kontext-Entity für ⭐ (aus URL)
    ==========================*/
    function getEntityFromURL(){
      const url = new URL(window.location.href);
      const params = url.searchParams;
      let type = params.get('type');
      let id   = params.get('id');
      let name = params.get('name');

      if (!type || !id) {
        const hash = (url.hash || '').replace(/^#/, '');
        if (hash) {
          const parts = hash.split(':');
          if (parts.length >= 2) {
            type = type || parts[0];
            id   = id   || parts[1];
            if (!name && parts[2]) name = decodeURIComponent(parts.slice(2).join(':'));
          }
        }
      }
      if (!type || !id) return null;
      return { type, id, name: name || `${type}:${id}` };
    }

    function updateFavUI(){
      const favIcon  = document.getElementById('nav-favorites');
      const favBadge = document.getElementById('badge-fav');
      if (!favIcon || !favBadge) return;

      const favs = loadFavs();
      const count = favs.length;

      if (count > 0){
        favBadge.textContent = formatCount(count);
        favBadge.classList.remove('hidden');
        favIcon.classList.add('has-favs');
      } else {
        favBadge.classList.add('hidden');
        favIcon.classList.remove('has-favs');
      }
    }

    function wireInteractions(){
      // ⭐ Toggle
      const favIcon = document.getElementById('nav-favorites');
      if (favIcon){
        favIcon.addEventListener('click', () => {
          const entity = getEntityFromURL();
          if (!entity){ console.warn("Kein Entitäts-Kontext für Favorit."); return; }
          let favs = loadFavs();
          const exists = favs.some(x => x.id===entity.id && x.type===entity.type);
          favs = exists ? favs.filter(x => !(x.id===entity.id && x.type===entity.type)) : (favs.push(entity), favs);
          saveFavs(favs);
          updateFavUI();
        });
      }

      // 🔔 Beispielwert (später dynamisch)
      const noti = document.getElementById('badge-noti');
      if (noti){
        const setNotificationCount = (n) => {
          if (n>0){ noti.textContent = formatCount(n); noti.classList.remove('hidden'); }
          else { noti.classList.add('hidden'); }
        };
        setNotificationCount(3);
      }

      // Visuelles Active-Feedback auf Klick
      document.querySelectorAll('.nav-icon[data-goto], .nav-icon .menu [data-goto]').forEach(el=>{
        el.addEventListener('click', ()=>{
          document.querySelectorAll('.nav-icon').forEach(i=>i.classList.remove('active'));
          const key = el.getAttribute('data-goto');
          const target = document.getElementById(`nav-${key}`) || el.closest('.nav-icon');
          target && target.classList.add('active');
        });
      });

      // Hash-Änderungen beobachten (für Hash-Fallback)
      window.addEventListener('hashchange', setActiveFromURL);
    }

    // Render + Init
    renderNav();
    setActiveFromURL();
    updateFavUI();
    wireInteractions();
  </script>
</body>
</html>
